name: Daily Python Commit

on:
  workflow_dispatch:  # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ
  schedule:
    - cron: '0 9 * * *'  # Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾ Ð² 09:00 Ð¿Ð¾ UTC
  push:
    branches: [ main ]

jobs:
  daily-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    env:
      PYTHON_VERSION: '3.11'
      
    steps:
    - name: ðŸ› ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ðŸ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
      run: |
        echo "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²..."
        python -m pip install --upgrade pip
        
    - name: ðŸ“‚ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ð¿Ð°Ð¿Ð¾Ðº
      run: |
        mkdir -p daily_python_scripts
        mkdir -p logs
        mkdir -p backups
        
    - name: ðŸ“ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
      id: check_files
      run: |
        TODAY=$(date +"%Y-%m-%d")
        COUNT=$(ls daily_python_scripts/${TODAY}_*.py 2>/dev/null | wc -l)
        echo "count=${COUNT}" >> $GITHUB_ENV
        echo "today=${TODAY}" >> $GITHUB_ENV
        
    - name: ðŸ Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
      id: generate_script
      run: |
        COUNTER=$(( ${{ env.count }} + 1 ))
        TODAY=${{ env.today }}
        
        # ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¾Ð² ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²
        IDEAS=(
          "hello"
          "calculator"
          "random"
          "data_processor"
          "file_manager"
          "api_client"
          "text_generator"
          "math_helper"
          "date_time"
          "string_utils"
        )
        
        # Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð°
        LAST_USED=""
        if [ -f "used_ideas.json" ]; then
          LAST_USED=$(cat used_ideas.json | grep "last_used_idea" | cut -d '"' -f 4)
        fi
        
        # Ð’Ñ‹Ð±Ð¾Ñ€ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð°, Ð¸ÑÐºÐ»ÑŽÑ‡Ð°Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹
        while true; do
          RANDOM_INDEX=$(( RANDOM % ${#IDEAS[@]} ))
          SELECTED_TYPE=${IDEAS[$RANDOM_INDEX]}
          if [ "$SELECTED_TYPE" != "$LAST_USED" ] || [ ${#IDEAS[@]} -eq 1 ]; then
            break
          fi
        done
        
        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ð³Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
        case $SELECTED_TYPE in
          "hello")
            CONTENT="print('Hello from daily script!')\nprint(f'Date: {TODAY}')\n"
            ;;
          "calculator")
            CONTENT="print('Simple calculator')\nprint(f'2 + 2 = {2+2}')\nprint(f'10 * 5 = {10*5}')\nprint(f'25 / 4 = {25/4}')\n"
            ;;
          "random")
            CONTENT="import random\nprint(f'Random number: {random.randint(1, 100)}')\nprint(f'Random choice: {random.choice(['apple', 'banana', 'cherry'])}')\n"
            ;;
          "data_processor")
            CONTENT="import random\ndata = [random.randint(1, 100) for _ in range(10)]\nprint(f'Data: {data}')\nprint(f'Sum: {sum(data)}')\nprint(f'Average: {sum(data) / len(data):.2f}')\n"
            ;;
          "file_manager")
            CONTENT="import os\nprint(f'Files in current directory:')\nfor file in os.listdir('.'):\n    print(f'  {{file}}')\nprint(f'Current directory: {os.getcwd()}')\n"
            ;;
          "api_client")
            CONTENT="# Ð˜Ð¼Ð¸Ñ‚Ð°Ñ†Ð¸Ñ API ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°\nprint('Simulating API request...')\nresponse = {\n    'status': 'success',\n    'data': {\n        'id': 123,\n        'name': 'John Doe',\n        'email': 'john@example.com'\n    }\n}\nprint(f'API Response: {response}')\n"
            ;;
          "text_generator")
            CONTENT="words = ['hello', 'world', 'python', 'script', 'daily', 'commit']\nimport random\ngenerated_text = ' '.join(random.sample(words, 4))\nprint(f'Generated text: {generated_text}')\n"
            ;;
          "math_helper")
            CONTENT="import math\nprint(f'Pi: {math.pi:.4f}')\nprint(f'Square root of 16: {math.sqrt(16)}')\nprint(f'Factorial of 5: {math.factorial(5)}')\n"
            ;;
          "date_time")
            CONTENT="from datetime import datetime, timedelta\nnow = datetime.now()\nprint(f'Current time: {now}')\ntomorrow = now + timedelta(days=1)\nprint(f'Tomorrow: {tomorrow.strftime("%Y-%m-%d")}')\n"
            ;;
          "string_utils")
            CONTENT="text = 'Hello World Python Script'\nprint(f'Original: {text}')\nprint(f'Lowercase: {text.lower()}')\nprint(f'Uppercase: {text.upper()}')\nprint(f'Word count: {len(text.split())}')\n"
            ;;
          *)
            CONTENT="print('Hello from daily script!')\nprint(f'Date: {TODAY}')\n"
            SELECTED_TYPE="hello"
            ;;
        esac
        
        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°
        FILENAME="${TODAY}_$(printf '%02d' $COUNTER)_${SELECTED_TYPE}.py"
        FILEPATH="daily_python_scripts/$FILENAME"
        echo "$CONTENT" > "$FILEPATH"
        
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½ Ñ„Ð°Ð¹Ð»: $FILENAME"
        echo "file_path=$FILEPATH" >> $GITHUB_ENV
        echo "file_name=$FILENAME" >> $GITHUB_ENV
        echo "idea_type=$SELECTED_TYPE" >> $GITHUB_ENV
        
    - name: ðŸ“¦ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ used_ideas.json
      run: |
        # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¸Ð´ÐµÐ¹
        if [ ! -f "used_ideas.json" ]; then
          cat > used_ideas.json << 'EOF'
{
  "last_used_idea": "",
  "ideas_count": {
    "hello": 0,
    "calculator": 0,
    "random": 0,
    "data_processor": 0,
    "file_manager": 0,
    "api_client": 0,
    "text_generator": 0,
    "math_helper": 0,
    "date_time": 0,
    "string_utils": 0
  }
}
EOF
        fi
        
        # ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾Ð± Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð´ÐµÑÑ…
        if command -v jq &> /dev/null; then
          # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ jq ÐµÑÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½
          jq --arg type "${{ env.idea_type }}" '.last_used_idea = $type | .ideas_count[$type] += 1' used_ideas.json > temp.json && mv temp.json used_ideas.json
        else
          # Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð±ÐµÐ· jq
          python -c "
import json
import os

def update_used_ideas():
    file_path = 'used_ideas.json'
    
    # Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    if os.path.exists(file_path):
        with open(file_path, 'r') as f:
            data = json.load(f)
    else:
        data = {
            'last_used_idea': '',
            'ideas_count': {
                'hello': 0, 'calculator': 0, 'random': 0,
                'data_processor': 0, 'file_manager': 0, 'api_client': 0,
                'text_generator': 0, 'math_helper': 0, 'date_time': 0, 'string_utils': 0
            }
        }
    
    # ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    idea_type = '${{ env.idea_type }}'
    data['last_used_idea'] = idea_type
    if idea_type in data['ideas_count']:
        data['ideas_count'][idea_type] += 1
    else:
        data['ideas_count'][idea_type] = 1
    
    # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
    with open(file_path, 'w') as f:
        json.dump(data, f, indent=2)

update_used_ideas()
"
        fi
        
        echo "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ Ñ„Ð°Ð¹Ð» used_ideas.json"
        
    - name: ðŸ“ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ README.md
      run: |
        # ÐŸÐ¾Ð´ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²
        SCRIPT_COUNT=$(find daily_python_scripts -name "*.py" | wc -l)
        
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ð±Ñ‰ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Ð¸Ð· used_ideas.json
        if command -v jq &> /dev/null; then
          TOTAL_GENERATED=$(jq '[.ideas_count[]] | add' used_ideas.json)
        else
          # Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´
          TOTAL_GENERATED=$(python -c "import json; data=json.load(open('used_ideas.json')); print(sum(data['ideas_count'].values()))" 2>/dev/null || echo 0)
        fi
        
        # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ð°Ð¼ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²
        STATS=""
        if command -v jq &> /dev/null; then
          for idea in hello calculator random data_processor file_manager api_client text_generator math_helper date_time string_utils; do
            count=$(jq -r ".ideas_count[\"$idea\"]" used_ideas.json 2>/dev/null || echo 0)
            if [ "$count" -gt 0 ]; then
              STATS="$STATS\n- $idea: $count times"
            fi
          done
        else
          # Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´
          for idea in hello calculator random data_processor file_manager api_client text_generator math_helper date_time string_utils; do
            count=$(python -c "import json; data=json.load(open('used_ideas.json')); print(data['ideas_count'].get('$idea', 0))" 2>/dev/null || echo 0)
            if [ "$count" -gt 0 ]; then
              STATS="$STATS\n- $idea: $count times"
            fi
          done
        fi
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¸Ð»Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ README.md
        cat > README.md << EOF
# Daily Python Scripts

Last update: $(date +"%Y-%m-%d")
Total scripts: $SCRIPT_COUNT ($TOTAL_GENERATED generated)

This repository is automatically updated daily with new Python scripts.

## Script Ideas Statistics
$STATS
EOF
        
        echo "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ README.md"
        
    - name: ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð»Ð¾Ð³Ð°
      run: |
        LOG_DIR="logs"
        LOG_FILE="${LOG_DIR}/daily_commit_$(date +"%Y-%m-%d").log"
        mkdir -p "$LOG_DIR"
        
        cat > "$LOG_FILE" << EOF
$(date +"%Y-%m-%d %H:%M:%S") - INFO - Starting daily commit process
$(date +"%Y-%m-%d %H:%M:%S") - INFO - Created script: ${{ env.file_name }}
$(date +"%Y-%m-%d %H:%M:%S") - INFO - README updated successfully
$(date +"%Y-%m-%d %H:%M:%S") - INFO - GitHub Actions workflow completed successfully
$(date +"%Y-%m-%d %H:%M:%S") - INFO - Daily commit process finished
EOF
        
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½ Ñ„Ð°Ð¹Ð» Ð»Ð¾Ð³Ð°: $LOG_FILE"
        
    - name: ðŸ“¤ ÐšÐ¾Ð¼Ð¼Ð¸Ñ‚ Ð¸ Ð¿ÑƒÑˆ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
      run: |
        git config --local user.email "Puper-1981@mail.ru"
        git config --local user.name "MaxMad446"
        git add .
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°
        if git diff-index --quiet HEAD --; then
          echo "ÐÐµÑ‚ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð°"
        else
          git commit -m "ðŸ¤– Daily commit: ${{ env.today }} - ${{ env.idea_type }} script"
          git push
          echo "Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð·Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‡ÐµÐ½Ñ‹ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹"
        fi
        
    - name: ðŸ“Š ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸
      run: |
        echo "========================================"
        echo "âœ… Ð•Ð–Ð•Ð”ÐÐ•Ð’ÐÐ«Ð™ ÐšÐžÐœÐœÐ˜Ð¢ Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð’Ð«ÐŸÐžÐ›ÐÐ•Ð"
        echo "========================================"
        echo "Ð”Ð°Ñ‚Ð°: ${{ env.today }}"
        echo "Ð’Ñ€ÐµÐ¼Ñ: $(date +"%H:%M:%S")"
        echo "Ð¡Ð¾Ð·Ð´Ð°Ð½ Ñ„Ð°Ð¹Ð»: ${{ env.file_name }}"
        echo "Ð¢Ð¸Ð¿ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°: ${{ env.idea_type }}"
        echo "ÐÐ¾Ð¼ÐµÑ€ Ð² ÑÐµÑ€Ð¸Ð¸: $(( ${{ env.count }} + 1 ))"
        echo "Ð’ÑÐµÐ³Ð¾ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð²: $(find daily_python_scripts -name "*.py" | wc -l)"
        echo "Ð¡ÑÑ‹Ð»ÐºÐ° Ð½Ð° ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚: https://github.com/${{ github.repository }}/commit/${{ github.sha }}"
        echo "========================================"